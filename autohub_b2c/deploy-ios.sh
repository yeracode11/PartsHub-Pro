#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–±–æ—Ä–∫–∏ iOS release –≤–µ—Ä—Å–∏–∏ AutoHub B2C

set -e

echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º —Å–±–æ—Ä–∫—É iOS release –≤–µ—Ä—Å–∏–∏..."

# –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd "$(dirname "$0")"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è Flutter
if ! command -v flutter &> /dev/null; then
    echo "‚ùå Flutter –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Flutter –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ PATH."
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ macOS
if [[ "$OSTYPE" != "darwin"* ]]; then
    echo "‚ùå iOS —Å–±–æ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –Ω–∞ macOS!"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ CocoaPods
if ! command -v pod &> /dev/null; then
    echo "‚ö†Ô∏è  CocoaPods –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é..."
    sudo gem install cocoapods
fi

# –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–±–æ—Ä–æ–∫
echo "üßπ –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–±–æ—Ä–æ–∫..."
flutter clean
flutter pub get

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ CocoaPods –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ iOS –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
cd ios
pod install
cd ..

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏
echo "üì± –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –∏–∑ pubspec.yaml:"
grep "version:" pubspec.yaml

# –°–±–æ—Ä–∫–∞ iOS
echo "üì¶ –°–±–æ—Ä–∫–∞ iOS release..."
flutter build ios --release

echo ""
echo "‚úÖ –°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo ""
echo "üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞—Ä—Ö–∏–≤–∞:"
echo "1. –û—Ç–∫—Ä–æ–π—Ç–µ Xcode:"
echo "   open ios/Runner.xcworkspace"
echo ""
echo "2. –í Xcode:"
echo "   - –í—ã–±–µ—Ä–∏—Ç–µ 'Any iOS Device' –≤ —Å—Ö–µ–º–∞—Ö"
echo "   - –í—ã–±–µ—Ä–∏—Ç–µ Product ‚Üí Archive"
echo "   - –î–æ–∂–¥–∏—Ç–µ—Å—å —Å–æ–∑–¥–∞–Ω–∏—è –∞—Ä—Ö–∏–≤–∞"
echo "   - –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ 'Distribute App'"
echo ""
echo "3. –î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:"
echo "   - –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ"
echo "   - –í—ã–±–µ—Ä–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤ —Å—Ö–µ–º–∞—Ö"
echo "   - –ù–∞–∂–º–∏—Ç–µ Run"
echo ""
echo "‚ö†Ô∏è  –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:"
echo "   - –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞"
echo "   - –í—ã–±—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π Team"
echo "   - –ù–∞—Å—Ç—Ä–æ–µ–Ω Bundle Identifier"

